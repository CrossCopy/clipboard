const { execFile } = require("node:child_process");
const fs = require("fs");

const execPath = "./client";
// const childWriteText = execFile(execPath, ["WRITE_TEXT"]);
// childWriteText.stdin.write("huakun zui shuai")
// childWriteText.stdin.end()
// childWriteText.stdout.on('data', (d) => {
//   console.log(d);
// })

const childWriteImage = execFile(execPath, ["WRITE_IMAGE"]);
const base64img =
  "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";
childWriteImage.stdin.write(base64img);
childWriteImage.stdin.end();

// const childWriteImage = execFile(execPath, ["WRITE_IMAGE"]);
// const base64img = "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"
// childWriteImage.stdin.write(base64img)
// childWriteImage.stdin.end()

// const childtext = execFile(execPath, ["READ_TEXT"]);
// childtext.stdout.on("data", (data) => {
//   console.log(Buffer.from(data, 'base64').toString());
// });

setTimeout(() => {
  const childimg = execFile(execPath, ["READ_IMAGE"]);
  childimg.stdout.on("data", (data) => {
    const imgBuf = Buffer.from(data, "base64");
    fs.writeFileSync("test.png", imgBuf);
  });
}, 1000);
